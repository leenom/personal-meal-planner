<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ì›”ê°„ ì‹ë‹¨ í”Œë˜ë„ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
            transition: all 0.3s ease-in-out;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            width: 100%;
        }
        .btn-primary {
            background-color: #4f46e5;
            color: white;
        }
        .btn-primary:hover {
            background-color: #4338ca;
        }
        .btn-secondary {
            background-color: #e5e7eb;
            color: #1f2937;
        }
         .btn-secondary:hover {
            background-color: #d1d5db;
        }
        .btn-tertiary {
            background-color: #10b981;
            color: white;
        }
        .btn-tertiary:hover {
            background-color: #059669;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #plan-output, #plan-output * {
                visibility: visible;
            }
            #plan-output {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            #action-buttons {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <!-- Header -->
        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">AI ì›”ê°„ ì‹ë‹¨ í”Œë˜ë„ˆ ğŸ¥—</h1>
            <p class="mt-4 text-lg text-gray-600">ê°€ì¡± ë§ì¶¤í˜• ê±´ê°• ì‹ë‹¨ì„ ê°„í¸í•˜ê²Œ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Input Form -->
            <div class="lg:col-span-1">
                <div class="card sticky top-8">
                    <h2 class="text-2xl font-bold mb-6 border-b pb-3 text-gray-800">1. ê°€ì¡± ì •ë³´ ì…ë ¥</h2>
                    <form id="meal-plan-form">
                        <div class="space-y-6">
                            <!-- Family Composition -->
                            <div>
                                <label class="block text-md font-medium text-gray-700 mb-2">ê°€ì¡± êµ¬ì„±ì›</label>
                                <div class="flex items-center space-x-4">
                                    <div class="flex items-center">
                                        <label for="adults" class="mr-2">ì„±ì¸</label>
                                        <input type="number" id="adults" value="2" min="1" class="w-20 p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div class="flex items-center">
                                        <label for="children" class="mr-2">ì–´ë¦°ì´</label>
                                        <input type="number" id="children" value="1" min="0" class="w-20 p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                            </div>

                            <!-- Dietary Preferences -->
                            <div>
                                <label class="block text-md font-medium text-gray-700 mb-2">ì‹ë‹¨ ì„±í–¥ (ì¤‘ë³µ ê°€ëŠ¥)</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center"><input type="checkbox" id="pref-vegetarian" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2">ì±„ì‹ ìœ„ì£¼</label>
                                    <label class="flex items-center"><input type="checkbox" id="pref-spicy" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2">ë§¤ìš´ ìŒì‹ ì„ í˜¸</label>
                                    <label class="flex items-center"><input type="checkbox" id="pref-seafood" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2">í•´ì‚°ë¬¼ ì„ í˜¸</label>
                                    <label class="flex items-center"><input type="checkbox" id="pref-kids-friendly" class="h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 mr-2">ì–´ë¦°ì´ ì…ë§›</label>
                                </div>
                            </div>

                            <!-- Health Goal -->
                            <div>
                                <label for="health-goal" class="block text-md font-medium text-gray-700 mb-2">ì£¼ìš” ëª©í‘œ</label>
                                <select id="health-goal" class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="general">ê· í˜• ì¡íŒ ì˜ì–‘</option>
                                    <option value="weight-loss">ì²´ì¤‘ ì¡°ì ˆ</option>
                                    <option value="muscle-gain">ê·¼ë ¥ ê°•í™”</option>
                                </select>
                            </div>

                            <!-- Meal Frequency -->
                            <div>
                                <label class="block text-md font-medium text-gray-700 mb-2">ì‹ì‚¬ íšŸìˆ˜</label>
                                <div class="flex space-x-4">
                                    <label class="flex items-center"><input type="radio" name="meal-freq" value="3" checked class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500 mr-2">ì•„ì¹¨, ì ì‹¬, ì €ë…</label>
                                    <label class="flex items-center"><input type="radio" name="meal-freq" value="2" class="h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500 mr-2">ì•„ì¹¨, ì €ë…</d>
                                </div>
                            </div>
                        </div>

                        <!-- Generate Buttons -->
                        <div class="mt-8 space-y-3">
                             <button type="button" id="generate-today-btn" class="btn btn-tertiary">
                                ğŸ² ì˜¤ëŠ˜ ë­ ë¨¹ì§€?
                            </button>
                             <button type="button" id="generate-week-btn" class="btn btn-secondary">
                                ğŸ“… ì¼ì£¼ì¼ ì‹ë‹¨ ìƒì„±
                            </button>
                            <button type="button" id="generate-month-btn" class="btn btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2v0Z"/><path d="M12 8v8"/><path d="m8.5 10.5 7 3-7 3Z"/></svg>
                                í•œ ë‹¬ ì‹ë‹¨ ìƒì„±
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Output Display -->
            <div class="lg:col-span-2">
                <div class="card min-h-[600px]">
                    <div class="flex justify-between items-center mb-6 border-b pb-3">
                         <h2 id="result-title" class="text-2xl font-bold text-gray-800">2. ë§ì¶¤ ì‹ë‹¨ ê²°ê³¼</h2>
                         <div id="action-buttons" class="hidden space-x-2">
                            <button id="print-btn" class="btn btn-secondary !w-auto">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                                ì¸ì‡„í•˜ê¸°
                            </button>
                         </div>
                    </div>
                   
                    <div id="plan-output" class="overflow-x-auto">
                        <div id="initial-message" class="flex flex-col items-center justify-center text-center h-96">
                            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400 mb-4"><path d="M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"></path><path d="M14 2v4a2 2 0 0 0 2 2h4"></path><path d="M10 9H8"></path><path d="M16 13H8"></path><path d="M16 17H8"></path></svg>
                            <p class="text-gray-500">ì¢Œì¸¡ì—ì„œ ì •ë³´ë¥¼ ì…ë ¥í•˜ê³ <br>ì›í•˜ëŠ” ê¸°ê°„ì˜ 'ì‹ë‹¨ ìƒì„±' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
                        </div>
                        <div id="loading-spinner" class="hidden flex items-center justify-center h-96">
                            <div class="loader"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- RECIPE DATABASE (EXPANDED) ---
        const recipes = {
            breakfast: [
                { name: 'í˜„ë¯¸ë°¥ê³¼ ë¯¸ì—­êµ­', tags: ['general', 'kids-friendly'] },
                { name: 'ìŠ¤í¬ë¨ë¸” ì—ê·¸ì™€ í†µë°€ë¹µ', tags: ['general', 'muscle-gain', 'kids-friendly'] },
                { name: 'ì˜¤íŠ¸ë°€ê³¼ ê³¼ì¼', tags: ['general', 'weight-loss', 'vegetarian', 'kids-friendly'] },
                { name: 'ë‹­ê°€ìŠ´ì‚´ ìƒŒë“œìœ„ì¹˜', tags: ['general', 'muscle-gain', 'weight-loss'] },
                { name: 'ê·¸ë¦­ ìš”ê±°íŠ¸ì™€ ê²¬ê³¼ë¥˜', tags: ['general', 'muscle-gain', 'weight-loss', 'vegetarian'] },
                { name: 'ê°„ë‹¨í•œ ê¹€ë°¥', tags: ['general', 'kids-friendly'] },
                { name: 'ë‘ë¶€ ìœ ë¶€ì´ˆë°¥', tags: ['general', 'weight-loss', 'vegetarian', 'kids-friendly'] },
                { name: 'ëˆ„ë£½ì§€ì™€ ê³„ë€ì°œ', tags: ['general', 'kids-friendly'] },
                { name: 'ì „ë³µì£½', tags: ['general', 'kids-friendly', 'seafood'] },
                { name: 'ì•¼ì±„ì£½', tags: ['general', 'vegetarian', 'kids-friendly'] },
                { name: 'í”„ë Œì¹˜ í† ìŠ¤íŠ¸', tags: ['general', 'kids-friendly'] },
                { name: 'ê³¼ì¼ ìŠ¤ë¬´ë””', tags: ['general', 'weight-loss', 'vegetarian', 'kids-friendly'] },
                { name: 'ë¯¸ìˆ«ê°€ë£¨', tags: ['general', 'vegetarian'] },
                { name: 'ë–¡êµ­', tags: ['general', 'kids-friendly'] },
                { name: 'ì‹œë¦¬ì–¼ê³¼ ìš°ìœ ', tags: ['general', 'kids-friendly'] }
            ],
            lunch_dinner: [
                 // ì°Œê°œ/íƒ•ë¥˜ (Stews/Soups)
                { name: 'ê¹€ì¹˜ì°Œê°œì™€ ì¡ê³¡ë°¥', tags: ['general', 'spicy'] },
                { name: 'ëœì¥ì°Œê°œì™€ ë³´ë¦¬ë°¥', tags: ['general', 'kids-friendly'] },
                { name: 'ìˆœë‘ë¶€ì°Œê°œ', tags: ['general', 'spicy', 'vegetarian', 'seafood'] },
                { name: 'ë¶€ëŒ€ì°Œê°œ', tags: ['general', 'spicy'] },
                { name: 'ë™íƒœì°Œê°œ', tags: ['general', 'spicy', 'seafood'] },
                { name: 'ì•Œíƒ•', tags: ['general', 'spicy', 'seafood'] },
                { name: 'ê°ìíƒ•', tags: ['general', 'spicy', 'muscle-gain'] },
                { name: 'ì„¤ë íƒ•', tags: ['general', 'muscle-gain', 'kids-friendly'] },
                { name: 'ê°ˆë¹„íƒ•', tags: ['general', 'muscle-gain'] },
                { name: 'ìœ¡ê°œì¥', tags: ['general', 'spicy', 'muscle-gain'] },
                { name: 'ì–´ë¬µíƒ•', tags: ['general', 'kids-friendly', 'seafood'] },
                { name: 'ì½©ë¹„ì§€ì°Œê°œ', tags: ['general', 'vegetarian', 'kids-friendly'] },
                { name: 'ì²­êµ­ì¥', tags: ['general'] },
                { name: 'ë‹­ë³¶ìŒíƒ•', tags: ['general', 'spicy', 'muscle-gain'] },
                { name: 'ì‚¼ê³„íƒ•', tags: ['general', 'muscle-gain'] },
                { name: 'ì¶”ì–´íƒ•', tags: ['general'] },

                // ë³¶ìŒ/êµ¬ì´/ì¡°ë¦¼ë¥˜ (Stir-fried/Grilled/Braised)
                { name: 'ì†Œë¶ˆê³ ê¸° ë®ë°¥', tags: ['general', 'muscle-gain', 'kids-friendly'] },
                { name: 'ì œìœ¡ë³¶ìŒê³¼ ìŒˆì±„ì†Œ', tags: ['general', 'muscle-gain', 'spicy'] },
                { name: 'ì˜¤ì§•ì–´ë³¶ìŒ', tags: ['general', 'spicy', 'seafood'] },
                { name: 'ì­ˆê¾¸ë¯¸ë³¶ìŒ', tags: ['general', 'spicy', 'seafood'] },
                { name: 'ë‚™ì§€ë³¶ìŒ', tags: ['general', 'spicy', 'seafood'] },
                { name: 'ë‹­ê°ˆë¹„', tags: ['general', 'muscle-gain', 'spicy'] },
                { name: 'ì˜¤ë¦¬ë¶ˆê³ ê¸°', tags: ['general', 'muscle-gain'] },
                { name: 'ê³ ë“±ì–´ êµ¬ì´ì™€ ìŒ€ë°¥', tags: ['general', 'seafood'] },
                { name: 'ì‚¼ì¹˜ êµ¬ì´', tags: ['general', 'seafood', 'kids-friendly'] },
                { name: 'LAê°ˆë¹„êµ¬ì´', tags: ['general', 'muscle-gain', 'kids-friendly'] },
                { name: 'ë–¡ê°ˆë¹„', tags: ['general', 'muscle-gain', 'kids-friendly'] },
                { name: 'ì‚¼ê²¹ì‚´ êµ¬ì´', tags: ['general', 'muscle-gain'] },
                { name: 'ë”ë•êµ¬ì´', tags: ['general', 'vegetarian', 'spicy'] },
                { name: 'ì½”ë‹¤ë¦¬ì¡°ë¦¼', tags: ['general', 'spicy', 'seafood'] },
                { name: 'ê°ˆì¹˜ì¡°ë¦¼', tags: ['general', 'spicy', 'seafood'] },
                { name: 'ë‘ë¶€ì¡°ë¦¼', tags: ['general', 'vegetarian', 'kids-friendly'] },
                { name: 'ê³„ë€ì¥ì¡°ë¦¼', tags: ['general', 'kids-friendly'] },
                
                // ë°¥/ë©´ë¥˜ (Rice/Noodles)
                { name: 'ë¹„ë¹”ë°¥', tags: ['general', 'weight-loss', 'vegetarian', 'spicy'] },
                { name: 'ê¹€ì¹˜ë³¶ìŒë°¥', tags: ['general', 'spicy'] },
                { name: 'ìƒˆìš°ë³¶ìŒë°¥', tags: ['general', 'seafood', 'kids-friendly'] },
                { name: 'ì˜¤ë¯€ë¼ì´ìŠ¤', tags: ['general', 'kids-friendly'] },
                { name: 'ì¹´ë ˆë¼ì´ìŠ¤', tags: ['general', 'kids-friendly'] },
                { name: 'ì§œì¥ë°¥', tags: ['general', 'kids-friendly'] },
                { name: 'íšŒë®ë°¥', tags: ['general', 'weight-loss', 'seafood', 'spicy'] },
                { name: 'ì•Œë°¥', tags: ['general', 'seafood', 'kids-friendly'] },
                { name: 'ì”ì¹˜êµ­ìˆ˜', tags: ['general'] },
                { name: 'ë¹„ë¹”êµ­ìˆ˜', tags: ['general', 'spicy'] },
                { name: 'ì¹¼êµ­ìˆ˜', tags: ['general', 'seafood'] },
                { name: 'ì½©êµ­ìˆ˜', tags: ['general', 'vegetarian'] },
                { name: 'ë¼ë©´', tags: ['general', 'spicy'] },
                { name: 'ì§œì¥ë©´', tags: ['general'] },
                { name: 'ì§¬ë½•', tags: ['general', 'spicy', 'seafood'] },
                { name: 'ìŒ€êµ­ìˆ˜', tags: ['general', 'seafood'] },
                { name: 'ë³¶ìŒìš°ë™', tags: ['general', 'seafood'] },
                
                // ì°œ/ê¸°íƒ€ í•œì‹ (Steamed/Other Korean)
                { name: 'ì°œë‹­', tags: ['general', 'muscle-gain', 'kids-friendly'] },
                { name: 'ì•„ê·€ì°œ', tags: ['general', 'spicy', 'seafood'] },
                { name: 'í•´ë¬¼ì°œ', tags: ['general', 'spicy', 'seafood'] },
                { name: 'ë¼ì§€ê³ ê¸° ìˆ˜ìœ¡', tags: ['general', 'muscle-gain'] },
                { name: 'ì¡±ë°œ', tags: ['general', 'muscle-gain'] },
                { name: 'í•´ë¬¼íŒŒì „', tags: ['general', 'seafood'] },
                { name: 'ê¹€ì¹˜ì „', tags: ['general', 'spicy'] },
                { name: 'ì¡ì±„', tags: ['general', 'vegetarian', 'kids-friendly'] },
                { name: 'ê³¨ë±…ì´ë¬´ì¹¨', tags: ['general', 'spicy'] },
                { name: 'ë¬µì€ì§€ ê¹€ì¹˜ì°œ', tags: ['general', 'spicy'] },
                { name: 'ë‹­ë°±ìˆ™', tags: ['general', 'muscle-gain'] },
                
                // ì–‘ì‹/ê¸°íƒ€ (Western/Others)
                { name: 'í† ë§ˆí†  í•´ì‚°ë¬¼ íŒŒìŠ¤íƒ€', tags: ['general', 'seafood'] },
                { name: 'í¬ë¦¼ ë²„ì„¯ ë¦¬ì¡°ë˜', tags: ['general', 'vegetarian', 'kids-friendly'] },
                { name: 'ì•Œë¦¬ì˜¤ ì˜¬ë¦¬ì˜¤', tags: ['general', 'vegetarian'] },
                { name: 'ë´‰ê³¨ë ˆ íŒŒìŠ¤íƒ€', tags: ['general', 'seafood'] },
                { name: 'ë¼ìëƒ', tags: ['general', 'muscle-gain'] },
                { name: 'í•¨ë°•ìŠ¤í…Œì´í¬', tags: ['general', 'muscle-gain', 'kids-friendly'] },
                { name: 'ëˆê¹ŒìŠ¤', tags: ['general', 'kids-friendly'] },
                { name: 'ì—°ì–´ ìŠ¤í…Œì´í¬ì™€ ì•„ìŠ¤íŒŒë¼ê±°ìŠ¤', tags: ['general', 'weight-loss', 'muscle-gain', 'seafood'] },
                { name: 'ì†Œê³ ê¸° ìŠ¤í…Œì´í¬', tags: ['general', 'muscle-gain'] },
                { name: 'ëª©ì‚´ ìŠ¤í…Œì´í¬', tags: ['general', 'muscle-gain'] },
                { name: 'ê³ ë¥´ê³¤ì¡¸ë¼ í”¼ì', tags: ['general', 'vegetarian', 'kids-friendly'] },
                { name: 'ë§ˆë¥´ê²Œë¦¬ë”° í”¼ì', tags: ['general', 'vegetarian'] },
                { name: 'ì›”ë‚¨ìŒˆ', tags: ['general', 'weight-loss', 'vegetarian'] },
                { name: 'ë§ˆíŒŒë‘ë¶€ ë®ë°¥', tags: ['general', 'spicy', 'vegetarian'] },
                { name: 'íƒ•ìˆ˜ìœ¡', tags: ['general'] },
                { name: 'ê¹í’ê¸°', tags: ['general', 'spicy'] },
                { name: 'ê¿”ë°”ë¡œìš°', tags: ['general'] },
                { name: 'ì–‘ì¥í”¼', tags: ['general', 'seafood'] },

                // ê±´ê°•ì‹/ì±„ì‹ (Healthy/Vegetarian)
                { name: 'ë‹­ê°€ìŠ´ì‚´ ìƒëŸ¬ë“œ', tags: ['weight-loss', 'muscle-gain', 'vegetarian'] },
                { name: 'ë¦¬ì½”íƒ€ì¹˜ì¦ˆ ìƒëŸ¬ë“œ', tags: ['weight-loss', 'vegetarian', 'kids-friendly'] },
                { name: 'ë‘ë¶€ ìŠ¤í…Œì´í¬', tags: ['weight-loss', 'muscle-gain', 'vegetarian'] },
                { name: 'ë²„ì„¯ ê°•ì •', tags: ['vegetarian', 'kids-friendly'] },
                { name: 'ì±„ì‹ ì¡ì±„', tags: ['vegetarian', 'kids-friendly'] },
                { name: 'ì½©ê³ ê¸° íƒ•ìˆ˜', tags: ['vegetarian', 'muscle-gain'] },
                { name: 'ì•¼ì±„ íŠ€ê¹€', tags: ['vegetarian'] },
                { name: 'ê¶ì¤‘ë–¡ë³¶ì´', tags: ['general', 'kids-friendly'] },
                { name: 'ì½¥ ìƒëŸ¬ë“œ', tags: ['weight-loss', 'muscle-gain']}
            ]
        };

        const form = document.getElementById('meal-plan-form');
        const outputDiv = document.getElementById('plan-output');
        const initialMessage = document.getElementById('initial-message');
        const loadingSpinner = document.getElementById('loading-spinner');
        const actionButtons = document.getElementById('action-buttons');
        const printBtn = document.getElementById('print-btn');
        const resultTitle = document.getElementById('result-title');

        const monthBtn = document.getElementById('generate-month-btn');
        const weekBtn = document.getElementById('generate-week-btn');
        const todayBtn = document.getElementById('generate-today-btn');

        monthBtn.addEventListener('click', () => prepareAndGenerate(30));
        weekBtn.addEventListener('click', () => prepareAndGenerate(7));
        todayBtn.addEventListener('click', () => prepareAndGenerate(1));
        
        printBtn.addEventListener('click', () => {
            window.print();
        });
        
        function prepareAndGenerate(days) {
            initialMessage.classList.add('hidden');
            outputDiv.innerHTML = ''; // Clear previous results
            outputDiv.appendChild(loadingSpinner);
            loadingSpinner.classList.remove('hidden');
            actionButtons.classList.add('hidden');
            resultTitle.textContent = '2. ë§ì¶¤ ì‹ë‹¨ ê²°ê³¼'; // Reset title

            // Simulate AI thinking time
            setTimeout(() => {
                generateMealPlan(days);
            }, 1000);
        }

        function generateMealPlan(numberOfDays) {
            // 1. Get user inputs
            const healthGoal = document.getElementById('health-goal').value;
            const mealFreq = document.querySelector('input[name="meal-freq"]:checked').value;
            const prefs = {
                vegetarian: document.getElementById('pref-vegetarian').checked,
                spicy: document.getElementById('pref-spicy').checked,
                seafood: document.getElementById('pref-seafood').checked,
                'kids-friendly': document.getElementById('pref-kids-friendly').checked,
            };

            // 2. Filter recipes based on inputs
            let filteredBreakfast = [...recipes.breakfast];
            let filteredLunchDinner = [...recipes.lunch_dinner];

            // Primary Goal Filter
            if (healthGoal !== 'general') {
                filteredBreakfast = filteredBreakfast.filter(r => r.tags.includes(healthGoal) || r.tags.includes('general'));
                filteredLunchDinner = filteredLunchDinner.filter(r => r.tags.includes(healthGoal) || r.tags.includes('general'));
            }

            // Preference Filter
            Object.keys(prefs).forEach(pref => {
                if(prefs[pref]) {
                    filteredBreakfast = filteredBreakfast.filter(r => r.tags.includes(pref));
                    filteredLunchDinner = filteredLunchDinner.filter(r => r.tags.includes(pref));
                }
            });
            
            // Check if there are enough recipes
            if (filteredBreakfast.length === 0 || filteredLunchDinner.length < 5) {
                 loadingSpinner.classList.add('hidden');
                 outputDiv.innerHTML = `<div class="text-center p-8 text-red-600 bg-red-50 rounded-lg">
                    <h3 class="font-bold text-lg mb-2">ë ˆì‹œí”¼ ë¶€ì¡±!</h3>
                    <p>ì„ íƒí•˜ì‹  ì¡°ê±´ì— ë§ëŠ” ì‹ë‹¨ì´ ë„ˆë¬´ ì ì–´ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ì¡°ê±´ì„ ì„ íƒí•´ì£¼ì„¸ìš”.<br/>(ì˜ˆ: ì±„ì‹ ìœ„ì£¼ì™€ í•´ì‚°ë¬¼ ì„ í˜¸ë¥¼ ë™ì‹œì— ì„ íƒí•˜ë©´ ë©”ë‰´ê°€ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.)</p>
                 </div>`;
                 return;
            }

            // 3. Generate plan
            let plan = [];
            let lastLunchDinner = '';
            for (let i = 1; i <= numberOfDays; i++) {
                const dayPlan = { day: i };
                
                dayPlan.breakfast = getRandomItem(filteredBreakfast).name;

                if (mealFreq === '3') {
                     let lunch;
                    do {
                        lunch = getRandomItem(filteredLunchDinner).name;
                    } while (lunch === lastLunchDinner);
                    dayPlan.lunch = lunch;
                    lastLunchDinner = lunch;
                } else {
                    dayPlan.lunch = 'â€”';
                }

                let dinner;
                do {
                    dinner = getRandomItem(filteredLunchDinner).name;
                } while (dinner === lastLunchDinner);
                dayPlan.dinner = dinner;
                lastLunchDinner = dinner;
                
                plan.push(dayPlan);
            }

            // 4. Display the plan
            displayPlan(plan, mealFreq, numberOfDays);
        }

        function getRandomItem(arr) {
            if (arr.length === 0) return { name: 'ì¶”ì²œ ë©”ë‰´ ì—†ìŒ' };
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function displayPlan(plan, mealFreq, numberOfDays) {
            loadingSpinner.classList.add('hidden');
            
            if (numberOfDays === 1) {
                resultTitle.textContent = "âœ¨ ì˜¤ëŠ˜ì˜ ì¶”ì²œ ë©”ë‰´";
            } else {
                resultTitle.textContent = `ğŸ“ ${numberOfDays}ì¼ ë§ì¶¤ ì‹ë‹¨ ê²°ê³¼`;
            }
            
            let tableHTML = `
                <table class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                        <tr>
                            <th scope="col" class="py-3 px-4 w-1/12 text-center">ë‚ ì§œ</th>
                            <th scope="col" class="py-3 px-4 w-3/12">ì•„ì¹¨</th>
                            ${mealFreq === '3' ? '<th scope="col" class="py-3 px-4 w-4/12">ì ì‹¬</th>' : ''}
                            <th scope="col" class="py-3 px-4 w-4/12">ì €ë…</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            plan.forEach(dayData => {
                let weekDay, dayClass, dateCellContent;

                if (numberOfDays === 1) {
                    const weekdays = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
                    const todayIndex = new Date().getDay();
                    weekDay = weekdays[todayIndex];
                    dayClass = 'bg-yellow-50';
                    dateCellContent = `ì˜¤ëŠ˜ (${weekDay})`;
                } else {
                    weekDay = getWeekday(dayData.day);
                    dayClass = 'bg-white';
                    if (weekDay === 'í† ') dayClass = 'bg-blue-50';
                    if (weekDay === 'ì¼') dayClass = 'bg-red-50';
                    dateCellContent = `${dayData.day}ì¼ (${weekDay})`;
                }

                tableHTML += `
                    <tr class="${dayClass} border-b">
                        <td class="py-3 px-4 font-medium text-gray-900 text-center">${dateCellContent}</td>
                        <td class="py-3 px-4">${dayData.breakfast}</td>
                        ${mealFreq === '3' ? `<td class="py-3 px-4">${dayData.lunch}</td>` : ''}
                        <td class="py-3 px-4">${dayData.dinner}</td>
                    </tr>
                `;
            });

            tableHTML += `</tbody></table>`;
            outputDiv.innerHTML = tableHTML;
            actionButtons.classList.remove('hidden');
        }

        function getWeekday(dayOfMonth) {
            // Assuming the month starts on a Monday for simplicity
            const dayIndex = (dayOfMonth - 1) % 7;
            const weekdays = ['ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† ', 'ì¼'];
            return weekdays[dayIndex];
        }
    </script>
</body>
</html>


